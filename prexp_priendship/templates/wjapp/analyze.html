{% extends "base.html" %}

{% block content%}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.css" rel="stylesheet" type="text/css" />

<style type="text/css">
.network {
	width: 100%;
	height: 400px;
	border: 1px solid lightgray;
}

p.collection-header{
	margin: 0px;
}

.graph-col {
	margin-top: 20px;
}
</style>

<div class="container">
	
	<div class="row">
		
		<div class="graph-col col m4 s12">
			<div id="fep-network" class="network z-depth-1"></div>
			<div class="collection with-header">
				<p class="collection-header center">
					<strong>1st Experiment</strong>
					(N={{fep_n}})
				</p>
				<p href="#!" class="collection-item">Lorem Ipsum</p>
				<p href="#!" class="collection-item">Lorem Ipsum</p>
			</div>	
		</div>

		<div class="graph-col col m4 s12">
			<div id="sep-network" class="network z-depth-1"></div>
			<div class="collection with-header">
				<p class="collection-header center">
					<strong>2nd Experiment</strong>
					(N={{sep_n}})
				</p>
				<p href="#!" class="collection-item">Lorem Ipsum</p>
				<p href="#!" class="collection-item">Lorem Ipsum</p>
			</div>	
		</div>

		<div class="graph-col col m4 s12 center">
			<div id="placeholder-block"></div>
			<div class="tooltipped" data-position="top" data-delay="50" data-tooltip="By 19th assembly vote result">
				<div id="v-network" class="network z-depth-1"></div>
			</div>
			<br>
			<div class="tooltipped" data-position="top" data-delay="50" data-tooltip="By 20th assembly's 13 features(Prof. Lee's work)">
				<div id="lwj-network" class="network z-depth-1"></div>
			</div>
		</div>

	</div>
	<div class="row center">
	</div>
</div>

<!-- fixed buttons -->
<div class="fixed-action-btn" style="bottom: 24px; left: 24px;">
	<a href="/" class="btn-floating btn-large waves-effect waves-light">
		<i class="material-icons">home</i>
	</a>
</div>
<div class="fixed-action-btn horizontal" style="bottom: 24px; right: 24px;">
	<a class="btn-floating btn-large teal">
		<i class="large material-icons">timeline</i>
	</a>
	<ul>
		<li>
			<a id="green-btn" class="green waves-effect waves-light btn btn-floating rel-btn"></a>
		</li>
		<li>
			<a id="red-btn" class="red waves-effect waves-light btn btn-floating rel-btn"></a>
		</li>
		<li>
			<a id="grey-btn" class="grey waves-effect waves-light btn btn-floating rel-btn"></a>
		</li>
	</ul>
</div>

<script>

function draw_network(container_id, raw_nodes, raw_edges, color_option){
	var container = document.getElementById(container_id);
	var edges = [];
	for(var idx = 0; idx < raw_edges.length; idx++){
		if(color_option == "green-btn"){
			if(raw_edges[idx]["color"]["color"] == "green"){
				edges.push(raw_edges[idx]);
			}
		} else if (color_option == "red-btn"){
			if(raw_edges[idx]["color"]["color"] == "red"){
				edges.push(raw_edges[idx]);
			}
		} else {
			edges = raw_edges;
		}
	}
	var nodes = new vis.DataSet(raw_nodes);
	var edges = new vis.DataSet(edges);

	var data = {
		nodes: nodes,
		edges: edges
	};
	var options = {};
	var network = new vis.Network(container, data, options);
	network.on("selectNode", function(params){
		focus_on_node_of_all(params["nodes"]);
	});
	return network;
}

function make_network_square(){
	$network = $(".network");
	$network.height($network.width());
}

function resize_placeholder(){
	$pb = $("#placeholder-block");
	$pb.css("margin-top", $(".graph-col:first").height());
}


function focus_on_node(network, node_id){
	var options = {
		scale: 1,
		offset: {x:0,y:0},
		animation: {
			duration: 500,
			easingFunction: "easeInOutQuad"
		}
	};

	network.focus(node_id, options);
	network.selectNodes([node_id]);
}

function focus_on_node_of_all(node_id){
	$network = $(".network");
	var nid_list = $network.map(function(){
		$nid =  $(this).attr("id");
		if(is_node_exist($nid, node_id)){
			focus_on_node(nobj_list[$nid], node_id);
		} else {
			nobj_list[$nid].fit();
			nobj_list[$nid].unselectAll();
		}
	});
}

function is_node_exist(netw_id, node_id){
	nodes = n_list[netw_id]["nodes"];
	for(var idx = 0; idx < nodes.length; idx++){
		if(nodes[idx]["id"] == node_id){
			return true;
		}
	}
	return false;
}

var fep_raw_nodes = {{fep_nodes|safe}};
var fep_raw_edges = {{fep_edges|safe}};
var sep_raw_nodes = {{sep_nodes|safe}};
var sep_raw_edges = {{sep_edges|safe}};
var v_raw_nodes = {{v_nodes|safe}};
var v_raw_edges = {{v_edges|safe}};
var lwj_raw_nodes = {{lwj_nodes|safe}};
var lwj_raw_edges = {{lwj_edges|safe}};

var n_list = {
	"fep-network": {"nodes": fep_raw_nodes, "edges": fep_raw_edges},
	"sep-network": {"nodes": sep_raw_nodes, "edges": sep_raw_edges},
	"v-network": {"nodes": v_raw_nodes, "edges": v_raw_edges},
	"lwj-network": {"nodes": lwj_raw_nodes, "edges": lwj_raw_edges},
}
var nobj_list = {}

$(document).ready(function(){
	make_network_square();
	resize_placeholder();
	$network = $(".network");
	$network.map(function(){
		$nid = $(this).attr("id");
		var nobj = draw_network($nid, n_list[$nid]["nodes"], n_list[$nid]["edges"], "grey-btn");
		nobj_list[$nid] = nobj;
	});

});


$(window).resize(function(){
	make_network_square();
	resize_placeholder();
});

$(".rel-btn").click(function(){
	var $color = $(this).attr("id");
	draw_network("fep-network", fep_raw_nodes, fep_raw_edges, $color);	
	draw_network("sep-network", sep_raw_nodes, sep_raw_edges, $color);	
});

</script>


{% endblock %}
